<!doctype html>
<html>
<head>
  <title>Socket.IO chat</title>

  <script src="/socket.io/socket.io.js"></script>
  <script src="http://code.jquery.com/jquery-1.11.1.js"></script>



    <style>
     #chat{ height : 500px;}
     #contentWrap{
      display:none;
    }

    #chatWrap
    {
      float:left;
      border:1px #000 solid;
    }
  </style>
</head>
<body>


  <script>
  // var socket = io('http://localhost:5000');

  jQuery(function($){
   var socket = io.connect();
   var $messageForm = $('#send-message');
   var $messageBox = $('#message');
   var $chat = $('#chat');
   var $nickForm =$('#setNick');
   var $nickError = $('#nickError');
   var $nickBox = $('#nickname');
   var $users = $('#users');

   $nickForm.submit(function(e){

    e.preventDefault();
    socket.emit('new user', $nickBox.val(), function(data){
      if(data){
        $('#nickWrap').hide();
        $('#contentWrap').show();
      } else {
        $nickError.html('Bro, This username is already Taken, Please choose different');
      }

    });
    $nickBox.val('');
  });

   socket.on('usernames',function(data){
    var html = '';
    for(i=0; i<data.names.length; i++)
    {
      html += data.names[i] + ' from ' +data.address+ '<br>'
    }
    $users.html(html);
  });
   
   $messageForm.submit(function(e){

    e.preventDefault();
    socket.emit('send message', $messageBox.val());
    console.log($messageBox.val());
    $messageBox.val('');
  });

   socket.on('new message',function(data){
     $chat.append('<b>' +data.nick+ ': </b>' +data.msg+ '<br/>');
   });
});

</script>

<div id="nickWrap">
 <p> Enter a username : </p>
 <p id= "nickError"></p>
 <form id="setNick">
   <input size ="35" id="nickname"></input>
   <input type="submit"></input>
 </form>
</div>

<div id="contentWrap">
  <div id="chatWrap">
    <div id="chat"></div>
    <form id="send-message">
     <input size="35" id="message"></input>
     <input type="submit"></input>
   </form>
 </div>
 <div id ="users"></div>


</body>
</html>